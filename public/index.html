<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" type="image/png" href="/icon-192x192.png">
    <title>Nepali Date and Calendar</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Noto+Sans+Devanagari:wght@400;600&display=swap" rel="stylesheet" />
    <style>
         :root {
            --primary-color: #2e7d32;
            --secondary-color: #4caf50;
            --accent-color: #8bc34a;
            --text-color: #333;
            --text-color1: #000000;
            --light-bg: #f9f9f9;
            --header-bg: #2e7d32;
            --today-highlight: #ffeb3b;
            --bs-color: #f28c38;
            --default-mode: ad;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Poppins", sans-serif;
        }
        
        body {
            background-color: var(--light-bg);
            color: var(--text-color);
            line-height: 1.6;
            font-size: clamp(14px, 2.5vw, 16px);
        }
        
        .container {
            max-width: 90%;
            margin: 0 auto;
            padding: 1rem;
        }
        
        header {
            text-align: center;
            background-color: var(--header-bg);
            color: white;
            padding: clamp(1rem, 3vw, 1.5rem);
            border-radius: 0.625rem;
            margin-bottom: 1.25rem;
        }
        
        header h1 {
            font-size: clamp(1.5rem, 5vw, 2rem);
        }
        
        header h2 {
            font-size: clamp(0.9rem, 3vw, 1.2rem);
            font-weight: 400;
        }
        
        .current-date {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1.25rem;
            flex-wrap: wrap;
        }
        
        .date-box {
            background-color: white;
            border: 2px solid var(--primary-color);
            border-radius: 0.625rem;
            padding: clamp(0.8rem, 2vw, 1.2rem);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
            flex: 1;
            min-width: min(150px, 40vw);
            max-width: 250px;
            transition: transform 0.2s;
        }
        
        .date-box:hover {
            transform: scale(1.02);
        }
        
        .label {
            font-size: clamp(0.8rem, 2.5vw, 0.9rem);
            color: var(--secondary-color);
            margin-bottom: 0.3rem;
            font-weight: 500;
        }
        
        .date-value {
            font-size: clamp(1rem, 3.5vw, 1.5rem);
            font-weight: 600;
            font-family: "Noto Sans Devanagari", sans-serif;
        }
        
        .calendar-header {
            background-color: white;
            border-radius: 0.625rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            padding: 1rem;
            margin-bottom: 1.25rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .calendar-header h3 {
            font-size: clamp(1.1rem, 3.5vw, 1.5rem);
            color: var(--primary-color);
            font-weight: 600;
            font-family: "Noto Sans Devanagari", sans-serif;
            flex: 1;
            text-align: center;
            min-width: 100%;
        }
        
        .calendar-header .bs-year {
            font-size: 0.8rem;
            color: var(--bs-color);
            margin-left: 0.3rem;
            font-family: "Noto Sans Devanagari", sans-serif;
        }
        
        .calendar-header .nav-buttons {
            display: flex;
            gap: 0.5rem;
        }
        
        .calendar-header button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 0.3125rem;
            padding: 0.6rem 0.9rem;
            cursor: pointer;
            font-size: 0.9rem;
            min-width: 44px;
            min-height: 44px;
            transition: background-color 0.3s, transform 0.1s;
        }
        
        .calendar-header button:hover {
            background-color: var(--secondary-color);
            transform: scale(1.05);
        }
        
        .calendar-header .selectors {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            flex-wrap: wrap;
            width: 100%;
            justify-content: center;
        }
        
        .calendar-header select {
            padding: 0.5rem;
            border-radius: 0.3125rem;
            border: 1px solid #ddd;
            font-size: 0.9rem;
            background-color: white;
            cursor: pointer;
            font-family: "Noto Sans Devanagari", sans-serif;
            min-width: 100px;
            flex: 1;
        }
        
        .calendar-header select:focus {
            outline: none;
            border-color: var(--primary-color);
        }
        
        .calendar-header #view-calendar,
        .calendar-header #toggle-mode {
            padding: 0.6rem 0.9rem;
            font-weight: 600;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, minmax(0, 1fr));
            gap: 0.3rem;
            background-color: #f0f0f0;
            padding: 0.6rem;
            border-radius: 0.3125rem;
        }
        
        .calendar-day-header {
            text-align: center;
            font-weight: 600;
            padding: 0.6rem;
            color: var(--primary-color);
            font-family: "Noto Sans Devanagari", sans-serif;
            font-size: clamp(0.7rem, 2.5vw, 0.9rem);
        }
        
        .calendar-day {
            background-color: white;
            text-align: center;
            padding: 0.4rem;
            border-radius: 0.3125rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: clamp(40px, 10vw, 70px);
            aspect-ratio: 1/1;
            position: relative;
        }
        
        .calendar-day:hover {
            background-color: var(--accent-color);
            color: white;
        }
        
         :root:not([data-mode="bs"]) .calendar-day .ad-date {
            font-size: clamp(0.8rem, 2.5vw, 1.1rem);
            font-weight: 600;
            color: var(--primary-color);
        }
        
         :root:not([data-mode="bs"]) .calendar-day .bs-date {
            font-size: clamp(0.6rem, 2vw, 0.7rem);
            color: var(--bs-color);
            font-family: "Noto Sans Devanagari", sans-serif;
        }
        
         :root[data-mode="bs"] .calendar-day .ad-date {
            font-size: clamp(0.6rem, 2vw, 0.7rem);
            color: var(--bs-color);
        }
        
         :root[data-mode="bs"] .calendar-day .bs-date {
            font-size: clamp(0.8rem, 2.5vw, 1.1rem);
            font-weight: 600;
            color: var(--primary-color);
            font-family: "Noto Sans Devanagari", sans-serif;
        }
        
        .calendar-day:hover .ad-date,
        .calendar-day:hover .bs-date {
            color: white;
        }
        
        .calendar-day.empty {
            background-color: transparent;
            cursor: default;
            aspect-ratio: 1/1;
        }
        
        .calendar-day.today {
            background-color: var(--today-highlight);
            font-weight: 600;
        }
        
        .month-display {
            display: block;
            font-size: 0.5em;
            margin-top: 2px;
            opacity: 0.7;
        }
        
        .converter {
            background-color: white;
            border-radius: 0.625rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 1rem;
        }
        
        .converter h3 {
            color: var(--primary-color);
            margin-bottom: 0.9rem;
            font-size: clamp(1rem, 3vw, 1.3rem);
            font-family: "Noto Sans Devanagari", sans-serif;
        }
        
        .converter-options {
            display: flex;
            flex-wrap: wrap;
            gap: 0.6rem;
            margin-bottom: 0.9rem;
        }
        
        .converter-options select,
        .converter-options input,
        .converter-options button {
            padding: 0.6rem;
            border-radius: 0.3125rem;
            border: 1px solid #ddd;
            font-size: 0.9rem;
            min-height: 44px;
            flex: 1;
            min-width: 120px;
        }
        
        .converter-options select {
            font-family: "Noto Sans Devanagari", sans-serif;
        }
        
        .converter-options button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .converter-options button:hover {
            background-color: var(--secondary-color);
        }
        
        .nepali-inputs {
            display: none;
            gap: 0.6rem;
            flex-wrap: wrap;
            width: 100%;
        }
        
        #conversion-result {
            padding: 0.9rem;
            background-color: #f0f0f0;
            border-radius: 0.3125rem;
            font-size: clamp(0.9rem, 2.5vw, 1.1rem);
            font-family: "Noto Sans Devanagari", sans-serif;
        }
        
        #enable-notifications,
        #install-app {
            margin: 0.625rem auto;
            display: block;
            padding: 0.625rem 1.25rem;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 0.3125rem;
            cursor: pointer;
            min-height: 44px;
            width: 100%;
            max-width: 300px;
        }
        /* Small screens (mobile, <= 480px) */
        
        @media (max-width: 480px) {
            .container {
                padding: 0.5rem;
            }
            .current-date {
                flex-direction: column;
                align-items: center;
                gap: 0.5rem;
            }
            .date-box {
                min-width: 100%;
                max-width: 100%;
            }
            .calendar-header {
                flex-direction: column;
                gap: 0.5rem;
            }
            .calendar-header .selectors {
                flex-direction: column;
                width: 100%;
                align-items: stretch;
            }
            .calendar-header select,
            .calendar-header button {
                width: 100%;
                font-size: 0.8rem;
                padding: 0.5rem;
            }
            .calendar-grid {
                gap: 0.2rem;
                padding: 0.4rem;
            }
            .calendar-day-header {
                padding: 0.4rem;
            }
            .calendar-day {
                padding: 0.2rem;
                min-height: clamp(35px, 12vw, 50px);
            }
            .month-display {
                display: none;
                /* Hide month name on very small screens */
            }
            .converter-options {
                flex-direction: column;
                gap: 0.5rem;
            }
            .converter-options select,
            .converter-options input,
            .converter-options button {
                width: 100%;
                font-size: 0.8rem;
                padding: 0.5rem;
            }
            .nepali-inputs {
                flex-direction: column;
            }
        }
        /* Medium screens (tablets, <= 768px) */
        
        @media (max-width: 768px) {
            .container {
                max-width: 95%;
            }
            .current-date {
                flex-direction: row;
            }
            .date-box {
                width: 100%;
                margin-bottom: 0.8rem;
            }
            .calendar-header {
                flex-direction: column;
                align-items: center;
            }
            .calendar-header .selectors {
                flex-direction: column;
                width: 100%;
                align-items: stretch;
            }
            .calendar-header select {
                width: 100%;
            }
            .calendar-header .nav-buttons {
                justify-content: center;
                width: 100%;
            }
            .month-display {
                font-size: 0.45em;
                /* Smaller month name on tablets */
            }
            .converter-options {
                flex-direction: column;
            }
            .converter-options select,
            .converter-options input,
            .converter-options button {
                width: 100%;
            }
        }
        /* Large screens (desktops, >= 1200px) */
        
        @media (min-width: 1200px) {
            .container {
                max-width: 1100px;
            }
            .date-box {
                min-width: 250px;
                padding: 1.2rem;
            }
            .calendar-day {
                min-height: 70px;
            }
            .calendar-day-header {
                font-size: 1rem;
            }
        }
        /* Extra small devices (<= 320px) */
        
        @media (max-width: 320px) {
            .calendar-day {
                padding: 0.1rem;
            }
            .calendar-day-header {
                font-size: 0.6rem;
                padding: 0.3rem;
            }
             :root:not([data-mode="bs"]) .calendar-day .ad-date {
                font-size: 0.7rem;
            }
             :root:not([data-mode="bs"]) .calendar-day .bs-date {
                font-size: 0.5rem;
            }
             :root[data-mode="bs"] .calendar-day .ad-date {
                font-size: 0.5rem;
            }
             :root[data-mode="bs"] .calendar-day .bs-date {
                font-size: 0.7rem;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>नेपाली मिति र पात्रो</h1>
            <h2>Nepali Date and Calendar</h2>
        </header>
        <div class="action-buttons">
            <button id="enable-notifications">Enable Notifications</button>
            <button id="install-app" style="display: none;">Install as Mobile App</button>
        </div>
        <div class="current-date">
            <div class="date-box">
                <div class="label">English Date</div>
                <div id="english-date" class="date-value">19 August 2025</div>
            </div>
            <div class="date-box">
                <div class="label">Nepali Date</div>
                <div id="nepali-date" class="date-value">२०८२ भदौ ३</div>
            </div>
        </div>
        <div class="calendar-container">
            <div class="calendar-header">
                <div class="nav-buttons">
                    <button id="prev-month">&lt;</button>
                </div>
                <h3 id="month-year"></h3>
                <div class="selectors">
                    <select id="calendar-year"></select>
                    <select id="calendar-month"></select>
                    <button id="view-calendar">View</button>
                    <button id="toggle-mode">Switch to BS</button>
                </div>
                <div class="nav-buttons">
                    <button id="next-month">&gt;</button>
                </div>
            </div>
            <div class="calendar-grid" id="calendar"></div>
        </div>
        <div class="converter">
            <h3>Date Converter</h3>
            <div class="converter-options">
                <select id="conversion-type">
                    <option value="eng-to-nep">English to Nepali</option>
                    <option value="nep-to-eng">Nepali to English</option>
                </select>
                <input type="date" id="english-date-input" />
                <div id="nepali-date-inputs" class="nepali-inputs">
                    <select id="nep-year"></select>
                    <select id="nep-month"></select>
                    <select id="nep-day"></select>
                </div>
                <button id="convert-btn">Convert</button>
            </div>
            <div id="conversion-result"></div>
        </div>
    </div>
    <script>
        // Nepali date data - days in each month from 2000 to 2090 BS
        const nepaliDateData = {
            2000: [30, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31],
            2001: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
            2002: [31, 31, 32, 32, 31, 30, 30, 29, 30, 29, 30, 30],
            2003: [31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31],
            2004: [30, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31],
            2005: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
            2006: [31, 31, 32, 32, 31, 30, 30, 29, 30, 29, 30, 30],
            2007: [31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31],
            2008: [31, 31, 31, 32, 31, 31, 29, 30, 30, 29, 29, 31],
            2009: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
            2010: [31, 31, 32, 32, 31, 30, 30, 29, 30, 29, 30, 30],
            2011: [31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31],
            2012: [31, 31, 31, 32, 31, 31, 29, 30, 30, 29, 30, 30],
            2013: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
            2014: [31, 31, 32, 32, 31, 30, 30, 29, 30, 29, 30, 30],
            2015: [31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31],
            2016: [31, 31, 31, 32, 31, 31, 29, 30, 30, 29, 30, 30],
            2017: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
            2018: [31, 32, 31, 32, 31, 30, 30, 29, 30, 29, 30, 30],
            2019: [31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31],
            2020: [31, 31, 31, 32, 31, 31, 30, 29, 30, 29, 30, 30],
            2021: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
            2022: [31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 30],
            2023: [31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31],
            2024: [31, 31, 31, 32, 31, 31, 30, 29, 30, 29, 30, 30],
            2025: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
            2026: [31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31],
            2027: [30, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31],
            2028: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
            2029: [31, 31, 32, 31, 32, 30, 30, 29, 30, 29, 30, 30],
            2030: [31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31],
            2031: [30, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31],
            2032: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
            2033: [31, 31, 32, 32, 31, 30, 30, 29, 30, 29, 30, 30],
            2034: [31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31],
            2035: [30, 32, 31, 32, 31, 31, 29, 30, 30, 29, 29, 31],
            2036: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
            2037: [31, 31, 32, 32, 31, 30, 30, 29, 30, 29, 30, 30],
            2038: [31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31],
            2039: [31, 31, 31, 32, 31, 31, 29, 30, 30, 29, 30, 30],
            2040: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
            2041: [31, 31, 32, 32, 31, 30, 30, 29, 30, 29, 30, 30],
            2042: [31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31],
            2043: [31, 31, 31, 32, 31, 31, 29, 30, 30, 29, 30, 30],
            2044: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
            2045: [31, 32, 31, 32, 31, 30, 30, 29, 30, 29, 30, 30],
            2046: [31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31],
            2047: [31, 31, 31, 32, 31, 31, 30, 29, 30, 29, 30, 30],
            2048: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
            2049: [31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 30],
            2050: [31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31],
            2051: [31, 31, 31, 32, 31, 31, 30, 29, 30, 29, 30, 30],
            2052: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
            2053: [31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 30],
            2054: [31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31],
            2055: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
            2056: [31, 31, 32, 31, 32, 30, 30, 29, 30, 29, 30, 30],
            2057: [31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31],
            2058: [30, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31],
            2059: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
            2060: [31, 31, 32, 32, 31, 30, 30, 29, 30, 29, 30, 30],
            2061: [31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31],
            2062: [30, 32, 31, 32, 31, 31, 29, 30, 29, 30, 29, 31],
            2063: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
            2064: [31, 31, 32, 32, 31, 30, 30, 29, 30, 29, 30, 30],
            2065: [31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31],
            2066: [31, 31, 31, 32, 31, 31, 29, 30, 30, 29, 29, 31],
            2067: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
            2068: [31, 31, 32, 32, 31, 30, 30, 29, 30, 29, 30, 30],
            2069: [31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31],
            2070: [31, 31, 31, 32, 31, 31, 29, 30, 30, 29, 30, 30],
            2071: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
            2072: [31, 32, 31, 32, 31, 30, 30, 29, 30, 29, 30, 30],
            2073: [31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 31],
            2074: [31, 31, 31, 32, 31, 31, 30, 29, 30, 29, 30, 30],
            2075: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
            2076: [31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 30],
            2077: [31, 32, 31, 32, 31, 30, 30, 30, 29, 30, 29, 31],
            2078: [31, 31, 31, 32, 31, 31, 30, 29, 30, 29, 30, 30],
            2079: [31, 31, 32, 31, 31, 31, 30, 29, 30, 29, 30, 30],
            2080: [31, 32, 31, 32, 31, 30, 30, 30, 29, 29, 30, 30],
            2081: [31, 31, 32, 32, 31, 30, 30, 30, 29, 30, 30, 30],
            2082: [30, 32, 31, 32, 31, 30, 30, 30, 29, 30, 30, 30],
            2083: [31, 31, 32, 31, 31, 30, 30, 30, 29, 30, 30, 30],
            2084: [31, 31, 32, 31, 31, 30, 30, 30, 29, 30, 30, 30],
            2085: [31, 32, 31, 32, 30, 31, 30, 30, 29, 30, 30, 30],
            2086: [30, 32, 31, 32, 31, 30, 30, 30, 29, 30, 30, 30],
            2087: [31, 31, 32, 31, 31, 31, 30, 30, 29, 30, 30, 30],
            2088: [30, 31, 32, 32, 30, 31, 30, 30, 29, 30, 30, 30],
            2089: [30, 32, 31, 32, 31, 30, 30, 30, 29, 30, 30, 30],
            2090: [30, 32, 31, 32, 31, 30, 30, 30, 29, 30, 30, 30]
        };
        const nepaliMonths = [
            "बैशाख", "जेठ", "असार", "श्रावण", "भदौ", "असोज",
            "कार्तिक", "मंसिर", "पुष", "माघ", "फाल्गुन", "चैत्र"
        ];
        const nepaliDays = [
            "आइतबार", "सोमबार", "मंगलबार", "बुधबार",
            "बिहिबार", "शुक्रबार", "शनिबार"
        ];
        const englishMonths = [
            "January", "February", "March", "April", "May", "June",
            "July", "August", "September", "October", "November", "December"
        ];
        const englishDays = [
            "Sunday", "Monday", "Tuesday", "Wednesday",
            "Thursday", "Friday", "Saturday"
        ];
        const refDateNepali = {
            year: 2000,
            month: 1,
            day: 1
        };
        const refDateEnglish = new Date(1943, 3, 14);
        const devanagariDigits = {
            '0': '०',
            '1': '१',
            '2': '२',
            '3': '३',
            '4': '४',
            '5': '५',
            '6': '६',
            '7': '७',
            '8': '८',
            '9': '९'
        };

        function toDevanagariNumber(num) {
            return num.toString().split('').map(digit => devanagariDigits[digit] || digit).join('');
        }

        function isLeapYear(year) {
            return (year % 400 === 0) || (year % 100 !== 0 && year % 4 === 0);
        }

        function getEnglishMonthDays(year, month) {
            const daysInMonth = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
            if (month === 1 && isLeapYear(year)) return 29;
            return daysInMonth[month];
        }

        function nepaliToEnglish(nepYear, nepMonth, nepDay) {
            if (!nepaliDateData[nepYear] || nepMonth < 1 || nepMonth > 12 || nepDay < 1 || nepDay > nepaliDateData[nepYear][nepMonth - 1]) {
                return null;
            }
            let totalDays = 0;
            for (let year = refDateNepali.year; year < nepYear; year++) {
                if (!nepaliDateData[year]) return null;
                totalDays += nepaliDateData[year].reduce((sum, days) => sum + days, 0);
            }
            for (let month = 0; month < nepMonth - 1; month++) {
                totalDays += nepaliDateData[nepYear][month];
            }
            totalDays += nepDay - 1;
            const resultDate = new Date(refDateEnglish);
            resultDate.setDate(resultDate.getDate() + totalDays);
            if (isNaN(resultDate.getTime())) return null;
            return resultDate;
        }

        function englishToNepali(engDate) {
            if (!(engDate instanceof Date) || isNaN(engDate.getTime())) return null;
            const diffTime = engDate - refDateEnglish;
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            if (diffDays < 0) return null;
            let remainingDays = diffDays;
            let nepYear = refDateNepali.year;
            while (remainingDays >= 0 && nepYear <= 2090) {
                if (!nepaliDateData[nepYear]) return null;
                const daysInYear = nepaliDateData[nepYear].reduce((sum, days) => sum + days, 0);
                if (remainingDays < daysInYear) break;
                remainingDays -= daysInYear;
                nepYear++;
            }
            if (nepYear > 2090 || remainingDays < 0) return null;
            let nepMonth = 0;
            while (nepMonth < 12 && remainingDays >= 0) {
                const daysInMonth = nepaliDateData[nepYear][nepMonth];
                if (remainingDays < daysInMonth) break;
                remainingDays -= daysInMonth;
                nepMonth++;
            }
            if (remainingDays < 0) return null;
            const nepDay = remainingDays + 1;
            if (nepMonth >= 12 || nepDay > nepaliDateData[nepYear][nepMonth]) return null;
            return {
                year: nepYear,
                month: nepMonth + 1,
                day: nepDay
            };
        }

        function formatNepaliDate(nepYear, nepMonth, nepDay) {
            return toDevanagariNumber(nepYear) + " " + nepaliMonths[nepMonth - 1] + " " + toDevanagariNumber(nepDay);
        }

        function formatEnglishDate(date) {
            const day = date.getDate();
            const month = englishMonths[date.getMonth()];
            const year = date.getFullYear();
            return day + " " + month + " " + year;
        }

        function getDayOfWeek(date) {
            return date.getDay();
        }

        function getEnglishMonthForNepali(year, month) {
            const nepaliFirstDay = nepaliToEnglish(year, month, 1);
            if (nepaliFirstDay) return {
                month: nepaliFirstDay.getMonth(),
                year: nepaliFirstDay.getFullYear()
            };
            return null;
        }

        const VAPID_PUBLIC_KEY = 'BOnFVmQVdrFQkSjjiAeL38URIkISYcCsyiUnPEd2zfZORiImrIYUqYhDjR1g-D1l7qLE9qIRVEEtzoDRdkN3MrI';

        function urlBase64ToUint8Array(base64String) {
            const padding = '='.repeat((4 - base64String.length % 4) % 4);
            const base64 = (base64String + padding).replace(/\-/g, '+').replace(/_/g, '/');
            const rawData = window.atob(base64);
            const outputArray = new Uint8Array(rawData.length);
            for (let i = 0; i < rawData.length; ++i) {
                outputArray[i] = rawData.charCodeAt(i);
            }
            return outputArray;
        }

        async function requestNotificationPermission() {
            const permission = await Notification.requestPermission();
            if (permission === 'granted') {
                console.log('Notification permission granted.');
                await subscribeUserToPush();
            } else {
                console.log('Notification permission denied.');
            }
        }

        async function subscribeUserToPush() {
            try {
                const registration = await navigator.serviceWorker.ready;
                const subscription = await registration.pushManager.subscribe({
                    userVisibleOnly: true,
                    applicationServerKey: urlBase64ToUint8Array(VAPID_PUBLIC_KEY)
                });
                await fetch('/subscribe', {
                    method: 'POST',
                    body: JSON.stringify(subscription),
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                console.log('User subscribed to push notifications.');
            } catch (error) {
                console.error('Error subscribing to push:', error);
            }
        }

        let deferredPrompt;
        const installButton = document.getElementById('install-app');
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installButton.style.display = 'block';
        });

        installButton.addEventListener('click', async() => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const {
                    outcome
                } = await deferredPrompt.userChoice;
                console.log(outcome === 'accepted' ? 'User accepted install' : 'User dismissed install');
                deferredPrompt = null;
                installButton.style.display = 'none';
            }
        });

        window.addEventListener('appinstalled', () => {
            console.log('PWA installed');
            installButton.style.display = 'none';
        });

        document.addEventListener('DOMContentLoaded', function() {
            updateCurrentDate();
            setupCalendar();
            setupDateConverter();
            setInterval(updateCurrentDate, 60000);
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js')
                    .then(reg => console.log('Service Worker registered:', reg))
                    .catch(err => console.error('Service Worker registration failed:', err));
            }
            document.getElementById('enable-notifications').addEventListener('click', requestNotificationPermission);
        });

        function updateCurrentDate() {
            const now = new Date();
            const englishDateStr = formatEnglishDate(now);
            document.getElementById('english-date').textContent = englishDateStr;
            const nepaliDate = englishToNepali(now);
            if (nepaliDate) {
                const nepaliDateStr = formatNepaliDate(nepaliDate.year, nepaliDate.month, nepaliDate.day);
                document.getElementById('nepali-date').textContent = nepaliDateStr;
            }
        }

        function setupCalendar() {
            const calendarEl = document.getElementById('calendar');
            const monthYearEl = document.getElementById('month-year');
            const prevMonthBtn = document.getElementById('prev-month');
            const nextMonthBtn = document.getElementById('next-month');
            const calendarYear = document.getElementById('calendar-year');
            const calendarMonth = document.getElementById('calendar-month');
            const viewCalendarBtn = document.getElementById('view-calendar');
            const toggleModeBtn = document.getElementById('toggle-mode');
            let currentDate = new Date();
            let currentNepaliDate = englishToNepali(currentDate);
            let currentMode = 'default';
            document.documentElement.setAttribute('data-mode', currentMode);
            toggleModeBtn.textContent = 'Show in BS';

            for (let year = 2000; year <= 2090; year++) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = `${toDevanagariNumber(year)} BS`;
                calendarYear.appendChild(option);
            }

            nepaliMonths.forEach((month, index) => {
                const option = document.createElement('option');
                option.value = index + 1;
                option.textContent = month;
                calendarMonth.appendChild(option);
            });

            calendarYear.value = currentNepaliDate.year;
            calendarMonth.value = currentNepaliDate.month;
            renderCalendar(currentNepaliDate.year, currentNepaliDate.month);

            prevMonthBtn.addEventListener('click', function() {
                if (currentMode === 'ad') {
                    const firstDayDate = nepaliToEnglish(currentNepaliDate.year, currentNepaliDate.month, 1);
                    if (!firstDayDate) return;
                    const adMonth = firstDayDate.getMonth();
                    const adYear = firstDayDate.getFullYear();
                    if (adMonth === 0) {
                        firstDayDate.setFullYear(adYear - 1);
                        firstDayDate.setMonth(11);
                    } else {
                        firstDayDate.setMonth(adMonth - 1);
                    }
                    const newNepaliDate = englishToNepali(firstDayDate);
                    if (newNepaliDate) {
                        currentNepaliDate.year = newNepaliDate.year;
                        currentNepaliDate.month = newNepaliDate.month;
                    }
                } else {
                    if (currentNepaliDate.month === 1) {
                        currentNepaliDate.year--;
                        currentNepaliDate.month = 12;
                    } else {
                        currentNepaliDate.month--;
                    }
                }
                calendarYear.value = currentNepaliDate.year;
                calendarMonth.value = currentNepaliDate.month;
                renderCalendar(currentNepaliDate.year, currentNepaliDate.month);
            });

            nextMonthBtn.addEventListener('click', function() {
                if (currentMode === 'ad') {
                    const firstDayDate = nepaliToEnglish(currentNepaliDate.year, currentNepaliDate.month, 1);
                    if (!firstDayDate) return;
                    const adMonth = firstDayDate.getMonth();
                    const adYear = firstDayDate.getFullYear();
                    if (adMonth === 11) {
                        firstDayDate.setFullYear(adYear + 1);
                        firstDayDate.setMonth(0);
                    } else {
                        firstDayDate.setMonth(adMonth + 1);
                    }
                    const newNepaliDate = englishToNepali(firstDayDate);
                    if (newNepaliDate) {
                        currentNepaliDate.year = newNepaliDate.year;
                        currentNepaliDate.month = newNepaliDate.month;
                    }
                } else {
                    if (currentNepaliDate.month === 12) {
                        currentNepaliDate.year++;
                        currentNepaliDate.month = 1;
                    } else {
                        currentNepaliDate.month++;
                    }
                }
                calendarYear.value = currentNepaliDate.year;
                calendarMonth.value = currentNepaliDate.month;
                renderCalendar(currentNepaliDate.year, currentNepaliDate.month);
            });

            viewCalendarBtn.addEventListener('click', function() {
                currentNepaliDate.year = parseInt(calendarYear.value);
                currentNepaliDate.month = parseInt(calendarMonth.value);
                renderCalendar(currentNepaliDate.year, currentNepaliDate.month);
            });

            toggleModeBtn.addEventListener('click', function() {
                if (currentMode === 'default') {
                    currentMode = 'bs';
                    toggleModeBtn.textContent = 'Show in AD';
                } else if (currentMode === 'bs') {
                    currentMode = 'ad';
                    toggleModeBtn.textContent = 'Show Both';
                } else {
                    currentMode = 'default';
                    toggleModeBtn.textContent = 'Show in BS';
                }
                document.documentElement.setAttribute('data-mode', currentMode);
                renderCalendar(currentNepaliDate.year, currentNepaliDate.month);
            });

            function renderCalendar(year, month) {
                calendarEl.innerHTML = '';
                const today = new Date();
                const todayNepali = englishToNepali(today);
                if (currentMode === 'ad') {
                    const firstDayDate = nepaliToEnglish(year, month, 1);
                    if (!firstDayDate) return;
                    const adYear = firstDayDate.getFullYear();
                    const adMonth = firstDayDate.getMonth();
                    const englishMonthName = englishMonths[adMonth];
                    monthYearEl.innerHTML = `${englishMonthName} ${adYear} AD`;
                    const firstDay = new Date(adYear, adMonth, 1).getDay();
                    const totalDays = getEnglishMonthDays(adYear, adMonth);
                    const dayHeaders = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                    dayHeaders.forEach(day => {
                        const dayEl = document.createElement('div');
                        dayEl.className = 'calendar-day-header';
                        dayEl.textContent = day;
                        calendarEl.appendChild(dayEl);
                    });
                    for (let i = 0; i < firstDay; i++) {
                        const emptyEl = document.createElement('div');
                        emptyEl.className = 'calendar-day empty';
                        calendarEl.appendChild(emptyEl);
                    }
                    for (let day = 1; day <= totalDays; day++) {
                        const dayEl = document.createElement('div');
                        dayEl.className = 'calendar-day';
                        const adDate = new Date(adYear, adMonth, day);
                        dayEl.innerHTML = `
                            <div class="ad-date">${adDate.getDate()}</div>
                            <div class="month-display">${englishMonthName}</div>
                        `;
                        if (adDate.toDateString() === today.toDateString()) {
                            dayEl.classList.add('today');
                        }
                        calendarEl.appendChild(dayEl);
                    }
                } else {
                    const firstDayDate = nepaliToEnglish(year, month, 1);
                    if (!firstDayDate) return;
                    const adYear = firstDayDate.getFullYear();
                    const englishMonthName = englishMonths[firstDayDate.getMonth()];
                    const firstDay = firstDayDate.getDay();
                    const totalDays = nepaliDateData[year][month - 1];
                    if (currentMode === 'bs') {
                        monthYearEl.innerHTML = `${nepaliMonths[month - 1]} ${toDevanagariNumber(year)} BS`;
                    } else {
                        monthYearEl.innerHTML = `
                            <div>${nepaliMonths[month - 1]} ${toDevanagariNumber(year)} BS</div>
                            <div>${englishMonthName} ${adYear} AD</div>
                        `;
                    }
                    const dayHeaders = currentMode === 'bs' ? ['आइत', 'सोम', 'मंगल', 'बुध', 'बिहि', 'शुक्र', 'शनि'] : ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                    dayHeaders.forEach(day => {
                        const dayEl = document.createElement('div');
                        dayEl.className = 'calendar-day-header';
                        dayEl.textContent = day;
                        calendarEl.appendChild(dayEl);
                    });
                    for (let i = 0; i < firstDay; i++) {
                        const emptyEl = document.createElement('div');
                        emptyEl.className = 'calendar-day empty';
                        calendarEl.appendChild(emptyEl);
                    }
                    for (let day = 1; day <= totalDays; day++) {
                        const dayEl = document.createElement('div');
                        dayEl.className = 'calendar-day';
                        const adDate = nepaliToEnglish(year, month, day);
                        if (adDate) {
                            const adMonth = englishMonths[adDate.getMonth()];
                            const bsMonth = nepaliMonths[month - 1];
                            if (currentMode === 'bs') {
                                dayEl.innerHTML = `
                                    <div class="bs-date">${toDevanagariNumber(day)}</div>
                                    <div class="month-display">${bsMonth}</div>
                                `;
                            } else {
                                dayEl.innerHTML = `
                                    <div class="bs-date">${toDevanagariNumber(day)}</div>
                                    <div class="ad-date">${adDate.getDate()}</div>
                                    <div class="month-display">${bsMonth} / ${adMonth}</div>
                                `;
                            }
                            if (todayNepali && year === todayNepali.year && month === todayNepali.month && day === todayNepali.day) {
                                dayEl.classList.add('today');
                            }
                        }
                        calendarEl.appendChild(dayEl);
                    }
                }
            }
        }

        function setupDateConverter() {
            const conversionType = document.getElementById('conversion-type');
            const englishDateInput = document.getElementById('english-date-input');
            const nepaliInputs = document.getElementById('nepali-date-inputs');
            const nepYear = document.getElementById('nep-year');
            const nepMonth = document.getElementById('nep-month');
            const nepDay = document.getElementById('nep-day');
            const convertBtn = document.getElementById('convert-btn');
            const resultEl = document.getElementById('conversion-result');

            for (let year = 2000; year <= 2090; year++) {
                const option = document.createElement('option');
                option.value = year;
                option.textContent = toDevanagariNumber(year);
                nepYear.appendChild(option);
            }

            nepaliMonths.forEach((month, index) => {
                const option = document.createElement('option');
                option.value = index + 1;
                option.textContent = month;
                nepMonth.appendChild(option);
            });

            function updateNepaliDays() {
                const year = parseInt(nepYear.value);
                const month = parseInt(nepMonth.value);
                nepDay.innerHTML = '';
                const daysInMonth = nepaliDateData[year][month - 1];
                for (let day = 1; day <= daysInMonth; day++) {
                    const option = document.createElement('option');
                    option.value = day;
                    option.textContent = toDevanagariNumber(day);
                    nepDay.appendChild(option);
                }
            }

            nepYear.addEventListener('change', updateNepaliDays);
            nepMonth.addEventListener('change', updateNepaliDays);
            updateNepaliDays();

            conversionType.addEventListener('change', function() {
                if (this.value === 'eng-to-nep') {
                    englishDateInput.style.display = 'block';
                    nepaliInputs.style.display = 'none';
                } else {
                    englishDateInput.style.display = 'none';
                    nepaliInputs.style.display = 'flex';
                }
            });

            convertBtn.addEventListener('click', function() {
                if (conversionType.value === 'eng-to-nep') {
                    if (!englishDateInput.value) {
                        resultEl.textContent = 'Please select an English date';
                        return;
                    }
                    const engDate = new Date(englishDateInput.value);
                    const nepDate = englishToNepali(engDate);
                    if (nepDate) {
                        const dayIndex = getDayOfWeek(engDate);
                        const nepaliDay = nepaliDays[dayIndex];
                        resultEl.innerHTML = `<strong>English Date:</strong> ${formatEnglishDate(engDate)}<br><strong>Nepali Date:</strong> ${formatNepaliDate(nepDate.year, nepDate.month, nepDate.day)}<br><strong>Day:</strong> ${nepaliDay}`;
                    } else {
                        resultEl.textContent = 'Invalid date or conversion not possible';
                    }
                } else {
                    const year = parseInt(nepYear.value);
                    const month = parseInt(nepMonth.value);
                    const day = parseInt(nepDay.value);
                    const engDate = nepaliToEnglish(year, month, day);
                    if (engDate) {
                        const dayIndex = getDayOfWeek(engDate);
                        const englishDay = englishDays[dayIndex];
                        resultEl.innerHTML = `<strong>Nepali Date:</strong> ${formatNepaliDate(year, month, day)}<br><strong>English Date:</strong> ${formatEnglishDate(engDate)}<br><strong>Day:</strong> ${englishDay}`;
                    } else {
                        resultEl.textContent = 'Invalid Nepali date';
                    }
                }
            });

            englishDateInput.style.display = 'block';
            nepaliInputs.style.display = 'none';
        }
    </script>
</body>

</html>